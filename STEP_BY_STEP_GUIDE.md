# 단계별 실행 가이드

> **이 문서는 사용자가 직접 수행해야 하는 작업을 순서대로 정리한 실행 가이드입니다.**  
> 각 단계를 순서대로 따라하시면 됩니다.

**예상 총 소요 시간**: 약 6-8시간  
**작성일**: 2025-01-27

---

## 📋 작업 순서

1. [데이터베이스 스키마 확인](#1-데이터베이스-스키마-확인) (30분)
2. [API 응답 검증](#2-api-응답-검증) (1시간)
3. [데이터 마이그레이션 실행](#3-데이터-마이그레이션-실행) (1시간)
4. [Firestore 인덱스 생성](#4-firestore-인덱스-생성) (30분)
5. [이메일 발송 서비스 설정](#5-이메일-발송-서비스-설정) (30분)
6. [데이터 백업 전략 수립](#6-데이터-백업-전략-수립) (1-2시간)

---

## 1. 데이터베이스 스키마 확인

### 목표
기존 데이터에 필요한 필드가 있는지 확인

### 실행 단계

#### ✅ 1-1. Firebase 콘솔 접속
1. 웹 브라우저 열기
2. [Firebase Console](https://console.firebase.google.com/) 접속
3. 프로젝트 선택
4. 좌측 메뉴에서 **"Firestore Database"** 클릭

#### ✅ 1-2. 캠페인 문서 확인
1. **"campaigns"** 컬렉션 클릭
2. 첫 번째 문서 열기
3. 다음 필드 확인:
   - [ ] `imageUrl` (string) - 있음/없음 체크
   - [ ] `category` (string) - 있음/없음 체크
   - [ ] `applicationsCount` (number) - 있음/없음 체크

**결과 기록**:
- [ ] 모든 필드 있음 → 마이그레이션 불필요
- [ ] 일부 필드 없음 → 3번 작업(마이그레이션) 필요

#### ✅ 1-3. 사용자 문서 확인
1. **"users"** 컬렉션 클릭
2. 첫 번째 문서 열기
3. 다음 필드 확인:
   - [ ] `displayName` (string) - 있음/없음 체크
   - [ ] `companyName` (string) - 있음/없음 체크 (광고주만)
   - [ ] `profile.platforms` (array) - 있음/없음 체크 (인플루언서만)
   - [ ] `profile.companyName` (string) - 있음/없음 체크 (광고주만)

**결과 기록**:
- [ ] 모든 필드 있음 → 마이그레이션 불필요
- [ ] 일부 필드 없음 → 3번 작업(마이그레이션) 필요

#### ✅ 1-4. 확인 완료
- [ ] 캠페인 문서 필드 확인 완료
- [ ] 사용자 문서 필드 확인 완료
- [ ] 마이그레이션 필요 여부 결정 완료

---

## 2. API 응답 검증

### 목표
실제 API가 올바른 데이터를 반환하는지 확인

### 실행 단계

#### ✅ 2-1. 개발 서버 실행
1. 터미널 열기
2. 프로젝트 루트 디렉토리로 이동
3. 다음 명령어 실행:
   ```bash
   npm run dev
   ```
4. 서버가 `http://localhost:3000`에서 실행되는지 확인

#### ✅ 2-2. 최신 캠페인 목록 API 테스트
1. 브라우저에서 다음 URL 접속:
   ```
   http://localhost:3000/api/campaigns/latest?limit=5
   ```
2. 응답 JSON 확인
3. 다음 필드 존재 여부 체크:
   - [ ] `success`: true
   - [ ] `data.campaigns[]`: 배열 존재
   - [ ] 각 캠페인에 `id` 필드 있음
   - [ ] 각 캠페인에 `title` 필드 있음
   - [ ] 각 캠페인에 `advertiserName` 필드 있음
   - [ ] 각 캠페인에 `description` 필드 있음
   - [ ] 각 캠페인에 `category` 필드 있음
   - [ ] 각 캠페인에 `imageUrl` 필드 있음 (null 가능)
   - [ ] 각 캠페인에 `applicationsCount` 필드 있음
   - [ ] 각 캠페인에 `objective` 필드 있음
   - [ ] 각 캠페인에 `budgetRange` 필드 있음
   - [ ] 각 캠페인에 `channel` 필드 있음
   - [ ] 각 캠페인에 `deadline` 필드 있음
   - [ ] 각 캠페인에 `isHot` 필드 있음

**문제 발견 시**:
- [ ] 필드 누락 → `WORK_SUMMARY.md`에 기록
- [ ] 에러 발생 → 에러 메시지 복사하여 기록
- [ ] 빈 응답 → 데이터베이스에 데이터 있는지 확인

#### ✅ 2-3. 인플루언서 캠페인 목록 API 테스트 (선택사항)
1. 브라우저에서 로그인 (인플루언서 계정)
2. 개발자 도구 열기 (F12)
3. **Network** 탭 열기
4. 다음 URL 접속: `http://localhost:3000/influencer/mypage`
5. Network 탭에서 `/api/influencers/[id]/campaigns` 요청 찾기
6. 응답 확인:
   - [ ] `success`: true
   - [ ] `data.grouped.applied[]`: 배열 존재
   - [ ] `data.grouped.completed[]`: 배열 존재

#### ✅ 2-4. 문의 API 테스트 (선택사항)
1. 브라우저에서 다음 URL 접속: `http://localhost:3000/contact`
2. 문의 폼 작성:
   - 이름 입력
   - 이메일 입력
   - 문의 내용 입력
3. **제출** 버튼 클릭
4. Firebase 콘솔에서 `contacts` 컬렉션 확인:
   - [ ] 새 문서가 생성되었는지 확인

#### ✅ 2-5. 검증 완료
- [ ] 최신 캠페인 목록 API 테스트 완료
- [ ] 모든 필수 필드 확인 완료
- [ ] 문제 발견 시 기록 완료

---

## 3. 데이터 마이그레이션 실행

### 목표
기존 데이터에 누락된 필드 자동 추가

### 사전 준비
- [ ] 1번 작업(스키마 확인) 완료
- [ ] 마이그레이션 필요 여부 확인 완료

### 실행 단계

#### ✅ 3-1. 환경변수 확인
1. 프로젝트 루트 디렉토리에서 `.env.local` 파일 열기
2. 다음 환경변수 확인:
   - [ ] `FIREBASE_ADMIN_PROJECT_ID` 있음
   - [ ] `FIREBASE_ADMIN_CLIENT_EMAIL` 있음
   - [ ] `FIREBASE_ADMIN_PRIVATE_KEY` 있음

**없으면**: Firebase 콘솔에서 서비스 계정 키 다운로드 필요

#### ✅ 3-2. 데이터 백업 (프로덕션인 경우)
1. Firebase 콘솔 접속
2. **Firestore Database** 클릭
3. 좌측 상단 **"내보내기"** 버튼 클릭
4. 백업 위치 선택 (Cloud Storage 버킷)
5. **"내보내기 시작"** 클릭
6. 백업 완료 대기

**참고**: 개발 환경에서는 생략 가능

#### ✅ 3-3. 마이그레이션 스크립트 실행
1. 터미널 열기
2. 프로젝트 루트 디렉토리로 이동
3. 다음 명령어 실행:
   ```bash
   npm run migrate
   ```
4. 콘솔 출력 확인:
   - [ ] "캠페인 문서 마이그레이션 시작..." 메시지 확인
   - [ ] "사용자 문서 마이그레이션 시작..." 메시지 확인
   - [ ] "마이그레이션 완료!" 메시지 확인
5. 결과 확인:
   - [ ] 업데이트된 문서 수 확인
   - [ ] 오류 발생 여부 확인

#### ✅ 3-4. 마이그레이션 결과 검증
1. Firebase 콘솔 접속
2. **Firestore Database** 클릭
3. **"campaigns"** 컬렉션 확인:
   - [ ] 문서 하나 열기
   - [ ] `category` 필드 확인
   - [ ] `applicationsCount` 필드 확인
4. **"users"** 컬렉션 확인:
   - [ ] 문서 하나 열기
   - [ ] `profile.platforms` 필드 확인 (인플루언서)
   - [ ] `profile.companyName` 필드 확인 (광고주)

#### ✅ 3-5. 데이터 검증 스크립트 실행
1. 터미널에서 다음 명령어 실행:
   ```bash
   npm run validate
   ```
2. 검증 결과 확인:
   - [ ] 모든 검증 통과 → 완료
   - [ ] 경고 발생 → 경고 내용 확인 (대부분 문제없음)
   - [ ] 오류 발생 → 오류 내용 기록

#### ✅ 3-6. 마이그레이션 완료
- [ ] 마이그레이션 스크립트 실행 완료
- [ ] 결과 검증 완료
- [ ] 데이터 검증 스크립트 실행 완료

---

## 4. Firestore 인덱스 생성

### 목표
쿼리 성능 향상 및 임시 필드 제거

### 실행 단계

#### ✅ 4-1. Firebase 콘솔 접속
1. [Firebase Console](https://console.firebase.google.com/) 접속
2. 프로젝트 선택
3. 좌측 메뉴에서 **"Firestore Database"** 클릭
4. 상단 탭에서 **"인덱스"** 클릭

#### ✅ 4-2. 인덱스 1 생성: 캠페인 상태 + 오픈일
1. **"인덱스 만들기"** 버튼 클릭
2. **컬렉션 ID** 입력: `campaigns`
3. **필드 추가** 클릭:
   - 필드 1: `status` 선택, **오름차순** 선택
   - 필드 2: `openedAt` 선택, **내림차순** 선택
4. **"만들기"** 버튼 클릭
5. 인덱스 생성 완료 대기 (1-5분)

#### ✅ 4-3. 인덱스 2 생성: 캠페인 광고주 + 생성일
1. **"인덱스 만들기"** 버튼 클릭
2. **컬렉션 ID** 입력: `campaigns`
3. **필드 추가** 클릭:
   - 필드 1: `advertiserId` 선택, **오름차순** 선택
   - 필드 2: `createdAt` 선택, **내림차순** 선택
4. **"만들기"** 버튼 클릭
5. 인덱스 생성 완료 대기 (1-5분)

#### ✅ 4-4. 인덱스 생성 확인
1. 인덱스 목록에서 확인:
   - [ ] 인덱스 1 상태: **"사용 가능"** 확인
   - [ ] 인덱스 2 상태: **"사용 가능"** 확인
2. 상태가 **"빌드 중"**이면 완료될 때까지 대기

#### ✅ 4-5. 코드 업데이트 (선택사항 - 나중에 해도 됨)
인덱스 생성이 완료되면:

1. `src/app/api/campaigns/route.ts.after-index` 파일 열기
2. 내용 확인
3. `src/app/api/campaigns/route.ts` 파일에 적용:
   - `_sortTime` 필드 제거
   - `orderBy` 직접 사용하도록 수정
4. `src/app/api/campaigns/latest/route.ts.after-index` 파일 열기
5. 내용 확인
6. `src/app/api/campaigns/latest/route.ts` 파일에 적용:
   - `_sortTime` 필드 제거
   - `orderBy` 직접 사용하도록 수정

**참고**: 이 작업은 나중에 해도 됩니다. 인덱스만 생성하면 됩니다.

#### ✅ 4-6. 테스트
1. 개발 서버 재시작: `npm run dev`
2. API 테스트 (2번 작업 참고)
3. 응답이 정상적으로 오는지 확인

#### ✅ 4-7. 인덱스 생성 완료
- [ ] 인덱스 1 생성 완료
- [ ] 인덱스 2 생성 완료
- [ ] 인덱스 상태 "사용 가능" 확인 완료

---

## 5. 이메일 발송 서비스 설정

### 목표
문의 접수 시 관리자에게 알림 이메일 발송

### 실행 단계

#### ✅ 5-1. 이메일 서비스 선택 및 API 키 발급

**옵션 A: Resend 사용 (권장)**
1. [Resend](https://resend.com) 접속
2. 회원가입 또는 로그인
3. 대시보드에서 **"API Keys"** 클릭
4. **"Create API Key"** 클릭
5. API 키 이름 입력 (예: "carrot-stop-production")
6. **"Add"** 클릭
7. API 키 복사 (한 번만 표시됨!)
   - [ ] API 키 복사 완료

**옵션 B: SendGrid 사용**
1. [SendGrid](https://sendgrid.com) 접속
2. 회원가입 또는 로그인
3. Settings → **"API Keys"** 클릭
4. **"Create API Key"** 클릭
5. API 키 이름 입력 및 권한 선택 (Full Access 권장)
6. **"Create & View"** 클릭
7. API 키 복사 (한 번만 표시됨!)
   - [ ] API 키 복사 완료

#### ✅ 5-2. 로컬 환경변수 설정
1. 프로젝트 루트 디렉토리에서 `.env.local` 파일 열기
2. 다음 환경변수 추가:

   **Resend 사용 시**:
   ```env
   RESEND_API_KEY=re_xxxxxxxxxxxxx
   EMAIL_FROM=noreply@yourdomain.com
   ADMIN_EMAIL=admin@yourdomain.com
   ```

   **SendGrid 사용 시**:
   ```env
   SENDGRID_API_KEY=SG.xxxxxxxxxxxxx
   EMAIL_FROM=noreply@yourdomain.com
   ADMIN_EMAIL=admin@yourdomain.com
   ```

3. 파일 저장
   - [ ] 환경변수 추가 완료

**참고**:
- `EMAIL_FROM`: 발신자 이메일 주소 (도메인 인증 필요)
- `ADMIN_EMAIL`: 관리자 이메일 주소 (문의 알림을 받을 주소)

#### ✅ 5-3. Vercel 환경변수 설정 (배포 환경)
1. [Vercel 대시보드](https://vercel.com) 접속
2. 프로젝트 선택
3. **Settings** 클릭
4. **"Environment Variables"** 클릭
5. 다음 변수 추가:
   - [ ] `RESEND_API_KEY` 또는 `SENDGRID_API_KEY` 추가
   - [ ] `EMAIL_FROM` 추가
   - [ ] `ADMIN_EMAIL` 추가
6. 각 변수에 대해 환경 선택:
   - [ ] Production 체크
   - [ ] Preview 체크
   - [ ] Development 체크
7. **"Save"** 클릭

#### ✅ 5-4. 도메인 인증 (프로덕션, 선택사항)
이메일 서비스에서 발신자 도메인을 인증해야 합니다:

**Resend**:
1. 대시보드 → **"Domains"** 클릭
2. **"Add Domain"** 클릭
3. 도메인 입력 (예: `yourdomain.com`)
4. DNS 레코드 추가 (서비스에서 제공하는 값)
5. 인증 완료 대기
   - [ ] 도메인 인증 완료

**SendGrid**:
1. Settings → **"Sender Authentication"** 클릭
2. **"Authenticate Your Domain"** 클릭
3. 도메인 입력 및 DNS 레코드 추가
4. 인증 완료 대기
   - [ ] 도메인 인증 완료

**참고**: 개발 환경에서는 생략 가능 (테스트 이메일 주소 사용)

#### ✅ 5-5. 테스트
1. 개발 서버 재시작: `npm run dev`
2. 브라우저에서 다음 URL 접속: `http://localhost:3000/contact`
3. 테스트 문의 제출:
   - 이름 입력
   - 이메일 입력 (실제 이메일 주소)
   - 문의 내용 입력
4. 확인:
   - [ ] 관리자 이메일 수신 확인 (스팸함도 확인)
   - [ ] 사용자 확인 이메일 수신 확인
   - [ ] Firebase 콘솔에서 `contacts` 컬렉션에 데이터 저장 확인

#### ✅ 5-6. 이메일 설정 완료
- [ ] API 키 발급 완료
- [ ] 로컬 환경변수 설정 완료
- [ ] Vercel 환경변수 설정 완료
- [ ] 테스트 완료

---

## 6. 데이터 백업 전략 수립

### 목표
데이터 손실 방지를 위한 정기 백업 계획 수립

### 실행 단계

#### ✅ 6-1. Firebase 자동 백업 설정
1. Firebase 콘솔 접속
2. **Firestore Database** 클릭
3. **"백업"** 탭 클릭
4. **"백업 예약"** 클릭
5. 백업 설정:
   - [ ] 백업 빈도 선택: **매일** (권장)
   - [ ] 백업 보관 기간 선택: **30일** (권장)
6. **"저장"** 클릭
7. 백업 스케줄 확인:
   - [ ] 백업 스케줄이 생성되었는지 확인

#### ✅ 6-2. 백업 복원 테스트 (선택사항)
1. Firebase 콘솔 → **Firestore Database** 클릭
2. **"가져오기"** 클릭
3. 테스트 백업 파일 선택
4. 복원 테스트 수행
5. 복원 프로세스 확인:
   - [ ] 복원이 정상 작동하는지 확인

#### ✅ 6-3. 백업 정책 문서화 (선택사항)
다음 내용을 메모 또는 문서로 정리:
- [ ] 백업 빈도: 매일
- [ ] 백업 보관 기간: 30일
- [ ] 백업 위치: Cloud Storage
- [ ] 복원 절차: Firebase 콘솔에서 가져오기

#### ✅ 6-4. 백업 전략 수립 완료
- [ ] Firebase 자동 백업 설정 완료
- [ ] 백업 스케줄 확인 완료

---

## ✅ 전체 작업 완료 체크리스트

### 중간 우선순위
- [ ] 1. 데이터베이스 스키마 확인 완료
- [ ] 2. API 응답 검증 완료
- [ ] 3. 데이터 마이그레이션 실행 완료

### 낮은 우선순위
- [ ] 4. Firestore 인덱스 생성 완료
- [ ] 5. 이메일 발송 서비스 설정 완료
- [ ] 6. 데이터 백업 전략 수립 완료

---

## 🆘 문제 발생 시

### 일반적인 문제 해결

1. **환경변수 오류**
   - `.env.local` 파일 확인
   - Vercel 환경변수 확인
   - 환경변수 이름 오타 확인

2. **Firebase 권한 오류**
   - 서비스 계정 키 확인
   - Firebase 프로젝트 ID 확인

3. **API 응답 오류**
   - 개발 서버 콘솔 로그 확인
   - 브라우저 개발자 도구 Network 탭 확인

4. **마이그레이션 오류**
   - 데이터 백업 확인
   - 환경변수 확인
   - Firebase 권한 확인

### 도움 요청 시 포함할 정보
- 작업 번호 (예: "3번 작업")
- 에러 메시지 (전체)
- 실행한 명령어
- 예상 결과 vs 실제 결과

---

## 📝 참고 자료

- **USER_TASKS_GUIDE.md**: 각 작업의 상세 설명 및 필요성
- **WORK_SUMMARY.md**: 전체 작업 현황
- **scripts/migrate-db.ts**: 마이그레이션 스크립트
- **scripts/validate-data.ts**: 데이터 검증 스크립트

---

**작성 완료일**: 2025-01-27  
**다음 업데이트**: 작업 완료 후 진행 상황 반영
